---
layout: prototype-without-header
title: Annotations
---

<main>
<form class="annotation-details dark-mode">

  <header class="annotation-details__header">

    <div class="annotation-details__header-title">
      <h1 class="heading-4">Edit annotations</h1>

      <p class="annotation-details__header-meta body-4">
        These edits will mark this image as verified
      </p>
    </div>

    <div class="annotation-details__header-action">
      <a
        href="/"
        class="button button--medium"
        >
        <svg class="icon icon--small"><use xlink:href="#icon-chevron-down"></use></svg>
        Add annotation
      </a>
    </div>

  </header>

  <figure
    class="annotation-details__figure"
    data-annotation-figure
    style="
      --image-width: 1920;
      --image-height: 1080;
      "
    >
    <img class="annotation-details__figure-image" src="https://fathomnet.org/static/m3/framegrabs/Doc%20Ricketts/images/0620/03_19_38_11.png" alt="Paragorgia arborea" />
    <svg aria-label="Concepts" onClick="window.onSvgClick(event)" class="annotation-details__figure-svg" viewBox="0 0 1920 1080" xmlns="http://www.w3.org/2000/svg">
      <g style="--color: #FEFF00;" data-annotation-box data-annotation-id="concept-1">
        <text fill="white" x="1040" y="440" style="font-size: 3em" class="annotation">Bathochordaeus</text>
        <path fill="none" stroke-width="10" stroke="white"
          d="
            m 1040 140
            h 500
            v 300
            h -500
            z
          ">
        </path>
      </g>
      <g style="--color: #11AFF0;" data-annotation-box data-annotation-id="concept-2">
        <text fill="white" x="640" y="640" style="font-size: 3em" class="annotation">Paragorgia arborea</text>
        <path fill="none" stroke-width="10" stroke="white"
          d="
            m 640 240
            h 500
            v 400
            h -500
            z
          ">
        </path>
      </g>
      <g style="--color: #EF5DA7;" data-annotation-box data-annotation-id="concept-3">
        <text fill="white" x="400" y="700" style="font-size: 3em" class="annotation">Aegina</text>
        <path fill="none" stroke-width="10" stroke="white"
          d="
            m 400 400
            h 300
            v 300
            h -300
            z
          ">
        </path>
      </g>
    </svg>
    <div class="annotation-details__figure-field-container">
      <ul class="annotation-details__figure-field-list">
        <li class="annotation-details__figure-field-item">
          <label style="--field-x: 1040; --field-y: 440;" class="field field--has-placeholder field--has-icon annotation-field" data-annotation-field="hidden" data-annotation-id="concept-1">
            <span class="field__label">Annotation</span>
            <input
              type="text"
              class="field__input"
              value="Bathochordaeus"
              placeholder="Annotation"
              list="search-concepts" />
            <svg class="icon field__icon"><use xlink:href="#icon-edit"></use></svg>
          </label>
        </li>
        <li class="annotation-details__figure-field-item">
          <label style="--field-x: 640; --field-y: 640;" class="field field--has-placeholder field--has-icon annotation-field" data-annotation-field="hidden" data-annotation-id="concept-2">
            <span class="field__label">Annotation</span>
            <input
              type="text"
              class="field__input"
              value="Paragorgia arborea"
              placeholder="Annotation"
              list="search-concepts" />
            <svg class="icon field__icon"><use xlink:href="#icon-edit"></use></svg>
          </label>
        </li>
        <li class="annotation-details__figure-field-item">
          <label style="--field-x: 400; --field-y: 700;"  class="field field--has-placeholder field--has-icon annotation-field" data-annotation-field="hidden" data-annotation-id="concept-3">
            <span class="field__label">Annotation</span>
            <input
              type="text"
              class="field__input"
              value="Aegina"
              placeholder="Annotation"
              list="search-concepts" />
            <svg class="icon field__icon"><use xlink:href="#icon-edit"></use></svg>
          </label>
        </li>
      </ul>
      {% include datalist.html %}
    </div>
  </figure>

  <script>
  function closest(element, tagName) {

    // If the element is the target
    if (element.nodeName.toLowerCase() === tagName) return element;

    var ancestor = element;
    while ((ancestor = ancestor.parentElement) && ancestor.nodeName && ancestor.nodeName.toLowerCase() !== tagName);
    if (ancestor && ancestor.nodeName && ancestor.nodeName.toLowerCase() === tagName) {
      return ancestor;
    }
  }
  let activeCaption, activateAnnotationID, activeFieldContainer, activeField;
  function activateAnnotation() {
    const box = document.querySelector(`[data-annotation-box][data-annotation-id=${activateAnnotationID}]`);
    
    const parent = box.parentNode;
    parent.removeChild(box);
    parent.appendChild(box);

    activeCaption = box.querySelector("text");
    activeFieldContainer = document.querySelector(`[data-annotation-field][data-annotation-id=${activateAnnotationID}]`);
    activeField = activeFieldContainer.querySelector(`input`);
    console.log({activeCaption, activeFieldContainer, activeField});

    activeFieldContainer.setAttribute("data-annotation-field", "visible");
    activeField.addEventListener("keyup", updateCaption);
    activeField.addEventListener("blur", deactivateAnnotation);
    activeField.focus();
  }
  function deactivateAnnotation() {
    if (activeFieldContainer && activeField) {
      activeFieldContainer.setAttribute("data-annotation-field", "hidden");
      activeField.removeEventListener("keyup", updateCaption);
      activeField.removeEventListener("blur", deactivateAnnotation);
    }
    activeFieldContainer = null;
    activeField = null;
    activeCaption = null;
  }
  function onSvgClick(event) {
    console.log(event.target);
    const group = closest(event.target, "g");

    deactivateAnnotation();
    activateAnnotationID = group.getAttribute("data-annotation-id");
    console.log({activateAnnotationID});
    activateAnnotation();
  }
  function updateCaption() {
    if (activeField && activeCaption) {
      activeCaption.textContent = activeField.value;
    }
  }
  const annotationsFields = document.querySelectorAll("[data-annotation-field] input");
  for (const field of annotationsFields) {
    field.addEventListener("focus", (event) => {
      console.log(event.target);
      const label = closest(field, "label");

      deactivateAnnotation();
      activateAnnotationID = label.getAttribute("data-annotation-id");
      console.log({activateAnnotationID});
      activateAnnotation();
    });
  }
  </script>

  <footer class="details-footer annotation-details__footer">
    <div class="details-footer__action-primary">
      <button type="submit" name="verify" value="1"
        href="/image-details/"
        class="button button--medium button--primary"
        >
        Save and verify
      </button>
      <button type="submit"
        href="/image-details/"
        class="button button--medium"
        >
        Save
      </button>
    </div>
    <div class="details-footer__nav">
      <ul class="details-footer__nav-list">
        <li class="details-footer__nav-item">
          <a
            class="link link--has-active-indicator"
            href="/annotations/"
            >
            <span class="link__active-indicator">Next</span>
            <svg class="icon"><use xlink:href="#icon-arrow-right"></use></svg>
          </a>
        </li>
        <li class="details-footer__nav-item">
          <a
            class="link link--has-active-indicator"
            href="/annotations/"
            >
            <svg class="icon"><use xlink:href="#icon-arrow-left"></use></svg>
            <span class="link__active-indicator">Previous</span>
          </a>
        </li>
      </ul>
      <p class="details-footer__nav-meta">1/468 images</p>
    </div>
    <div class="details-footer__action-secondary">
      <a
        href="/image-details/"
        class="button button--medium"
        >
        Cancel
      </a>
    </div>
  </footer>

</form>
</main>
